{% extends "base.html" %}

{% block title %}Manage Images - e-Rugah{% endblock %}

{% block content %}
<style>
body { background: linear-gradient(135deg, #ffe4b5, #ffedd5); color: white; text-shadow: 0 0 5px rgba(0,0,0,0.5); animation: fadeIn 0.5s ease-in; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.bi { color: #ff6b35; }

.dashboard-card {
    background: rgba(255, 140, 66, 0.3);
    border: 1px solid rgba(255, 107, 53, 0.4);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(255, 107, 53, 0.2);
    transition: all 0.3s ease;
    animation: slideUp 0.6s ease-out;
}
.dashboard-card:hover { transform: translateY(-5px); box-shadow: 0 12px 40px rgba(255, 107, 53, 0.4); }

@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

.btn {
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
    border: none;
    background: linear-gradient(45deg, #ff6b35, #ff8c42);
    color: white;
}
.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, #ff8c42, #ffa552);
    transition: left 0.4s ease;
    z-index: 0;
}
.btn:hover::before { left: 0; }
.btn > * { position: relative; z-index: 1; }
.btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(255, 107, 53, 0.5); }

.table { background: rgba(255, 140, 66, 0.2); border: 1px solid rgba(255, 107, 53, 0.3); }
.table th, .table td { border-color: rgba(255, 107, 53, 0.3); color: white; }
.alert { background: rgba(255, 140, 66, 0.25); border: 1px solid rgba(255, 107, 53, 0.4); color: white; }

.image-thumbnail { width: 100px; height: 100px; object-fit: cover; border-radius: 5px; }
</style>

<div class="page-header">
    <div>
        <h5 class="mb-0" style="font-size: 1.1rem;"><i class="bi bi-images"></i> Manage Images</h5>
        <p class="mb-1 mt-1 small" style="font-size: 0.8rem; color: rgba(0, 0, 0, 0.8);">Upload, delete, and replace images for different sections</p>
    </div>
</div>

<div class="row">
    {% for section, data in images.items() %}
    <div class="col-md-6 mb-4">
        <div class="dashboard-card">
            <h6 class="mb-3" style="font-size: 0.9rem;"><i class="bi bi-folder"></i> {{ section|title }} Images</h6>

            <!-- Upload Form -->
            <form method="post" enctype="multipart/form-data" class="mb-3">
                <input type="hidden" name="section" value="{{ section }}">
                <input type="hidden" name="action" value="upload">
                <div class="input-group">
                    <input type="file" name="files" class="form-control" multiple accept="image/*" required>
                    <button class="btn btn-sm" type="submit"><i class="bi bi-upload"></i> Upload</button>
                </div>
            </form>

            <!-- Images List -->
            {% if data.files %}
            <div class="row">
                {% for img in data.files %}
                <div class="col-md-6 mb-3">
                    <div class="card bg-transparent border-secondary">
                        <img src="{{ url_for('static', filename=data.url_prefix + img) }}" class="card-img-top image-thumbnail" alt="{{ img }}">
                        <div class="card-body p-2">
                            <p class="card-text small">{{ img }}</p>
                            <div class="d-flex justify-content-between">
                                <!-- Replace Form -->
                                <form method="post" enctype="multipart/form-data" class="d-inline">
                                    <input type="hidden" name="section" value="{{ section }}">
                                    <input type="hidden" name="action" value="replace">
                                    <input type="hidden" name="old_filename" value="{{ img }}">
                                    <input type="file" name="new_file" class="form-control form-control-sm d-none" id="replace-{{ section }}-{{ loop.index }}" accept="image/*" onchange="this.form.submit()">
                                    <button class="btn btn-sm btn-warning" type="button" onclick="document.getElementById('replace-{{ section }}-{{ loop.index }}').click()"><i class="bi bi-arrow-repeat"></i></button>
                                </form>
                                <!-- Delete Form -->
                                <form method="post" class="d-inline" onsubmit="return confirm('Delete this image?')">
                                    <input type="hidden" name="section" value="{{ section }}">
                                    <input type="hidden" name="action" value="delete">
                                    <input type="hidden" name="filename" value="{{ img }}">
                                    <button class="btn btn-sm btn-danger" type="submit"><i class="bi bi-trash"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="alert alert-info">
                <i class="bi bi-info-circle"></i> No images in this section.
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}