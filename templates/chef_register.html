{% extends "base.html" %}

{% block title %}Chef Registration - e-Rugah{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/chef-register-modern.css') }}">

<div class="chef-page-container">
    <div class="chef-page-content">
        <!-- Header -->
        <div class="chef-page-header">
            <h1 class="page-title">Join as a Chef</h1>
            <p class="page-subtitle">Share your culinary passion with food lovers. Complete the registration in 4 simple steps.</p>
        </div>

        <!-- Progress Stepper -->
        <div class="progress-stepper">
            <div class="progress-line">
                <div class="progress-line-fill" id="progressFill" style="width: 25%;"></div>
            </div>
            
            <div class="step active" data-step="1">
                <div class="step-circle">
                    <span class="step-number">1</span>
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                </div>
                <span class="step-label">Account</span>
            </div>
            
            <div class="step" data-step="2">
                <div class="step-circle">
                    <span class="step-number">2</span>
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                </div>
                <span class="step-label">Personal Info</span>
            </div>
            
            <div class="step" data-step="3">
                <div class="step-circle">
                    <span class="step-number">3</span>
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                </div>
                <span class="step-label">Location</span>
            </div>
            
            <div class="step" data-step="4">
                <div class="step-circle">
                    <span class="step-number">4</span>
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                </div>
                <span class="step-label">Expertise</span>
            </div>
        </div>

        <!-- Form Body -->
        <div class="chef-page-body">
            <form method="POST" class="chef-form" id="chefRegistrationForm" enctype="multipart/form-data">
                
                <!-- Step 1: Account Information -->
                <div class="form-step active" data-step="1">
                    <h2 class="step-title">Create Your Account</h2>
                    <p class="step-description">Let's start with your login credentials. Choose a strong password to keep your account secure.</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <div class="input-wrapper">
                                <div class="input-icon">
                                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                        <polyline points="22,6 12,13 2,6"/>
                                    </svg>
                                </div>
                                <input type="email" class="form-input" id="email" name="email" placeholder=" " required>
                                <label class="form-label" for="email">Email Address</label>
                            </div>
                            <div class="error-message" id="emailError">
                                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </svg>
                                Please enter a valid email address
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="input-wrapper">
                                <div class="input-icon">
                                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                    </svg>
                                </div>
                                <input type="password" class="form-input" id="password" name="password" placeholder=" " required>
                                <label class="form-label" for="password">Password</label>
                                <button class="password-toggle" type="button" id="togglePassword">
                                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" id="eyeIcon">
                                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
                                        <line x1="1" y1="1" x2="23" y2="23"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="password-strength" id="passwordStrength">
                                <div class="strength-bar">
                                    <div class="strength-fill" id="strengthFill"></div>
                                </div>
                                <div class="strength-requirements">
                                    <div class="requirement" id="lengthReq">
                                        <div class="requirement-icon"></div>
                                        At least 8 characters
                                    </div>
                                    <div class="requirement" id="uppercaseReq">
                                        <div class="requirement-icon"></div>
                                        One uppercase letter
                                    </div>
                                    <div class="requirement" id="lowercaseReq">
                                        <div class="requirement-icon"></div>
                                        One lowercase letter
                                    </div>
                                    <div class="requirement" id="numberReq">
                                        <div class="requirement-icon"></div>
                                        One number
                                    </div>
                                    <div class="requirement" id="specialReq">
                                        <div class="requirement-icon"></div>
                                        One special character
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="remember-container">
                        <input type="checkbox" id="remember_chef" name="remember_me" class="remember-checkbox">
                        <label for="remember_chef" class="remember-label">Remember me on this device</label>
                        <span class="remember-description">Stay logged in for 30 days</span>
                    </div>
                </div>

                <!-- Step 2: Personal Information -->
                <div class="form-step" data-step="2">
                    <h2 class="step-title">Personal Information</h2>
                    <p class="step-description">Tell us about yourself. This information will be visible to customers.</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <div class="input-wrapper">
                                <div class="input-icon">
                                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                        <circle cx="12" cy="7" r="4"/>
                                    </svg>
                                </div>
                                <input type="text" class="form-input" id="name" name="name" placeholder=" " required>
                                <label class="form-label" for="name">Full Name</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="input-wrapper">
                                <div class="input-icon">
                                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                                    </svg>
                                </div>
                                <input type="tel" class="form-input" id="phone" name="phone" placeholder=" " required>
                                <label class="form-label" for="phone">Phone Number</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label static-label">Profile Photo</label>
                        <div class="file-upload-wrapper">
                            <label for="photo" class="file-upload-area" id="fileUploadArea">
                                <div class="file-upload-icon">
                                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="17 8 12 3 7 8"/>
                                        <line x1="12" y1="3" x2="12" y2="15"/>
                                    </svg>
                                </div>
                                <p class="file-upload-text">Click to upload or drag and drop</p>
                                <p class="file-upload-hint">PNG, JPG or JPEG (MAX. 5MB)</p>
                            </label>
                            <input type="file" id="photo" name="photo" accept="image/*" required style="display: none;">
                            <div class="file-upload-preview" id="filePreview">
                                <img src="" alt="Preview" class="preview-image" id="previewImage">
                                <p class="preview-name" id="previewName"></p>
                            </div>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <div class="input-wrapper">
                            <div class="input-icon">
                                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                            </div>
                            <textarea class="form-input form-textarea" id="about" name="about" placeholder=" " rows="4" required></textarea>
                            <label class="form-label" for="about">About You</label>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Location -->
                <div class="form-step" data-step="3">
                    <h2 class="step-title">Where Are You Located?</h2>
                    <p class="step-description">Help customers find you by providing your location details.</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <div class="input-wrapper">
                                <div class="input-icon">
                                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                        <circle cx="12" cy="10" r="3"/>
                                    </svg>
                                </div>
                                <input type="text" class="form-input" id="county" name="county" placeholder=" " required>
                                <label class="form-label" for="county">County</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="input-wrapper">
                                <div class="input-icon">
                                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                        <circle cx="12" cy="10" r="3"/>
                                    </svg>
                                </div>
                                <input type="text" class="form-input" id="sub_county" name="sub_county" placeholder=" " required>
                                <label class="form-label" for="sub_county">Sub-County</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="input-wrapper">
                                <div class="input-icon">
                                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                        <circle cx="12" cy="10" r="3"/>
                                    </svg>
                                </div>
                                <input type="text" class="form-input" id="town" name="town" placeholder=" " required>
                                <label class="form-label" for="town">Town</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Expertise -->
                <div class="form-step" data-step="4">
                    <h2 class="step-title">Your Culinary Expertise</h2>
                    <p class="step-description">List up to 5 meals you specialize in. These will be featured on your profile.</p>
                    
                    <div class="meals-grid" id="mealsContainer">
                        <div class="meal-input-wrapper">
                            <div class="meal-number">1</div>
                            <input type="text" class="meal-input" name="meals" placeholder="e.g., Beef Stew with Ugali" required>
                        </div>
                        <div class="meal-input-wrapper">
                            <div class="meal-number">2</div>
                            <input type="text" class="meal-input" name="meals" placeholder="e.g., Chicken Curry">
                        </div>
                        <div class="meal-input-wrapper">
                            <div class="meal-number">3</div>
                            <input type="text" class="meal-input" name="meals" placeholder="e.g., Vegetable Pilau">
                        </div>
                        <div class="meal-input-wrapper">
                            <div class="meal-number">4</div>
                            <input type="text" class="meal-input" name="meals" placeholder="e.g., Fish Stew">
                        </div>
                        <div class="meal-input-wrapper">
                            <div class="meal-number">5</div>
                            <input type="text" class="meal-input" name="meals" placeholder="e.g., Ugali & Sukuma Wiki">
                        </div>
                    </div>
                    
                    <div class="meal-hint">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 16v-4"/>
                            <path d="M12 8h.01"/>
                        </svg>
                        At least one meal is required. You can add more later from your dashboard.
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <polyline points="15 18 9 12 15 6"/>
                        </svg>
                        <span>Previous</span>
                    </button>
                    <button type="button" class="btn btn-primary" id="nextBtn">
                        <span class="btn-text">Next Step</span>
                        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <polyline points="9 18 15 12 9 6"/>
                        </svg>
                        <div class="btn-loader">
                            <div class="spinner"></div>
                        </div>
                    </button>
                </div>
            </form>

            <div class="auth-footer">
                <p class="auth-footer-text">Already have an account? <a href="{{ url_for('login') }}" class="auth-link">Sign In</a></p>
            </div>
        </div>
    </div>
</div>

<!-- Notification -->
<div class="notification" id="notification">
    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <polyline points="20 6 9 17 4 12"/>
    </svg>
    <span id="notificationText">Success!</span>
</div>

<!-- Floating Verify Button -->
<button type="button" id="floatingVerifyBtn" style="display: none; position: fixed; bottom: 2rem; right: 2rem; background: linear-gradient(135deg, #f97316, #ea580c); color: white; border: none; border-radius: 50px; padding: 1rem 1.5rem; font-size: 1rem; font-weight: 600; cursor: pointer; box-shadow: 0 10px 25px rgba(249, 115, 22, 0.4); z-index: 1000; transition: all 0.3s ease; animation: pulse 2s infinite;">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
        <polyline points="22 4 12 14.01 9 11.01"/>
    </svg>
    Complete Verification
</button>

<!-- Verification Choice Modal -->
<div class="modal-backdrop-custom" id="verificationChoiceBackdrop" data-modal="verificationChoice">
    <div class="chef-modal" id="verificationChoiceModal">
        <div class="modal-content-custom">
            <div class="modal-body-custom">
                <div class="chef-auth-section">
                    <div class="chef-brand-section">
                        <div class="brand-icon">
                            <div class="icon-circle">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                    <polyline points="22 4 12 14.01 9 11.01"/>
                                </svg>
                            </div>
                        </div>
                        <h1 class="brand-title">Verify Your Account</h1>
                        <p class="brand-subtitle">Choose a verification method to get started</p>
                    </div>
                    <div class="chef-form">
                        <button type="button" id="chooseEmailBtn" class="chef-btn" style="margin-bottom: 1rem;">
                            <span class="btn-text">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
                                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                    <polyline points="22,6 12,13 2,6"/>
                                </svg>
                                Verify Email
                            </span>
                        </button>
                        <button type="button" id="chooseSmsBtn" class="chef-btn" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                            <span class="btn-text">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
                                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                                </svg>
                                Verify SMS
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Email Verification Modal -->
<div class="modal-backdrop-custom" id="emailVerificationBackdrop" data-modal="emailVerification">
    <div class="chef-modal" id="emailVerificationModal">
        <div class="modal-content-custom">
            <button type="button" class="modal-close-btn" id="closeEmailModal" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; cursor: pointer; color: #94a3b8; font-size: 1.5rem; line-height: 1; padding: 0.5rem; z-index: 10;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <div class="modal-body-custom">
                <div class="chef-auth-section">
                    <div class="chef-brand-section">
                        <div class="brand-icon">
                            <div class="icon-circle">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                                    <polyline points="22,6 12,13 2,6"/>
                                </svg>
                            </div>
                        </div>
                        <h1 class="brand-title">Email Verification</h1>
                        <p class="brand-subtitle">Enter the 4-digit code sent to your email</p>
                    </div>
                    <div class="chef-form">
                        <div class="input-wrapper">
                            <input type="text" class="form-input" id="emailCode" placeholder="Enter 4-digit code" maxlength="4" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;">
                        </div>
                        <div class="email-code-error" id="emailCodeError" style="display: none; color: #ef4444; text-align: center; margin-top: 1rem;"></div>
                        <button type="button" id="verifyEmailBtn" class="chef-btn" style="margin-top: 1.5rem;">
                            <span class="btn-text">Verify Email</span>
                        </button>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button type="button" id="resendEmailCodeBtn" class="auth-link" style="background: none; border: none; cursor: pointer;">Resend Code</button>
                            <p id="emailResendTimer" style="color: #94a3b8; font-size: 0.875rem; margin-top: 0.5rem;"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- SMS Verification Modal -->
<div class="modal-backdrop-custom" id="smsVerificationBackdrop" data-modal="smsVerification">
    <div class="chef-modal" id="smsVerificationModal">
        <div class="modal-content-custom">
            <button type="button" class="modal-close-btn" id="closeSmsModal" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; cursor: pointer; color: #94a3b8; font-size: 1.5rem; line-height: 1; padding: 0.5rem; z-index: 10;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <div class="modal-body-custom">
                <div class="chef-auth-section">
                    <div class="chef-brand-section">
                        <div class="brand-icon">
                            <div class="icon-circle">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                                </svg>
                            </div>
                        </div>
                        <h1 class="brand-title">SMS Verification</h1>
                        <p class="brand-subtitle">Enter the 4-digit code sent to your phone</p>
                    </div>
                    <div class="chef-form">
                        <div class="input-wrapper">
                            <input type="text" class="form-input" id="smsCode" placeholder="Enter 4-digit code" maxlength="4" style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;">
                        </div>
                        <div class="sms-code-error" id="smsCodeError" style="display: none; color: #ef4444; text-align: center; margin-top: 1rem;"></div>
                        <button type="button" id="verifySmsBtn" class="chef-btn" style="margin-top: 1.5rem;">
                            <span class="btn-text">Verify SMS</span>
                        </button>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button type="button" id="resendSmsCodeBtn" class="auth-link" style="background: none; border: none; cursor: pointer;">Resend Code</button>
                            <p id="smsResendTimer" style="color: #94a3b8; font-size: 0.875rem; margin-top: 0.5rem;"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Modal Styles - Override any external CSS */
.modal-backdrop-custom {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    background: rgba(0, 0, 0, 0.5) !important;
    backdrop-filter: blur(8px) !important;
    z-index: 1050 !important;
    display: none !important;
    align-items: center !important;
    justify-content: center !important;
    opacity: 0 !important;
    transition: opacity 0.3s ease !important;
}

.modal-backdrop-custom.active {
    display: flex !important;
    opacity: 1 !important;
}

.modal-backdrop-custom.closing {
    display: flex !important;
    opacity: 0 !important;
}

.modal-backdrop-custom .chef-modal {
    width: 90% !important;
    max-width: 450px !important;
    background: white !important;
    border-radius: 20px !important;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3) !important;
    transform: translateY(-30px) scale(0.95) !important;
    opacity: 0 !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    position: relative !important;
    display: block !important;
}

.modal-backdrop-custom.active .chef-modal {
    transform: translateY(0) scale(1) !important;
    opacity: 1 !important;
}

.modal-backdrop-custom.closing .chef-modal {
    transform: translateY(30px) scale(0.95) !important;
    opacity: 0 !important;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-backdrop-custom .modal-content-custom {
    padding: 2.5rem !important;
}

.modal-backdrop-custom .modal-body-custom {
    padding: 0 !important;
}

.modal-backdrop-custom .chef-auth-section {
    display: block !important;
    padding: 0 !important;
    grid-template-columns: unset !important;
    gap: 0 !important;
    min-height: auto !important;
}

.modal-backdrop-custom .chef-brand-section {
    text-align: center !important;
    margin-bottom: 2rem !important;
    padding: 0 !important;
    position: static !important;
}

.modal-backdrop-custom .brand-icon {
    margin-bottom: 1.5rem !important;
    display: flex !important;
    justify-content: center !important;
}

.modal-backdrop-custom .icon-circle {
    width: 80px !important;
    height: 80px !important;
    border-radius: 50% !important;
    background: linear-gradient(135deg, #ff6b6b, #f97316) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    margin: 0 auto !important;
    box-shadow: 0 8px 24px rgba(255, 107, 107, 0.3) !important;
}

.modal-backdrop-custom .brand-title {
    font-size: 1.75rem !important;
    font-weight: 700 !important;
    color: #1a202c !important;
    margin-bottom: 0.5rem !important;
}

.modal-backdrop-custom .brand-subtitle {
    color: #64748b !important;
    font-size: 0.95rem !important;
}

.modal-backdrop-custom .chef-form {
    max-width: 100% !important;
}

.modal-backdrop-custom .chef-btn {
    width: 100% !important;
    padding: 1rem 2rem !important;
    background: linear-gradient(135deg, #ff6b6b, #f97316) !important;
    border: none !important;
    border-radius: 12px !important;
    color: white !important;
    font-size: 1rem !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
    box-shadow: 0 4px 16px rgba(255, 107, 107, 0.3) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}

.modal-backdrop-custom .chef-btn:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 8px 24px rgba(255, 107, 107, 0.4) !important;
}

.modal-backdrop-custom .auth-link {
    color: #ff6b6b !important;
    font-weight: 600 !important;
}

.modal-backdrop-custom .auth-link:hover {
    color: #f97316 !important;
}

/* Floating Verify Button Styles */
#floatingVerifyBtn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 15px 35px rgba(249, 115, 22, 0.5);
}

@keyframes pulse {
    0%, 100% {
        box-shadow: 0 10px 25px rgba(249, 115, 22, 0.4);
    }
    50% {
        box-shadow: 0 10px 35px rgba(249, 115, 22, 0.6);
    }
}

.modal-close-btn:hover {
    color: #ef4444 !important;
    transform: scale(1.1);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Modal Manager - Prevents modal overlaying
    class ModalManager {
        constructor() {
            this.currentModal = null;
            this.modals = {
                verificationChoice: document.getElementById('verificationChoiceBackdrop'),
                emailVerification: document.getElementById('emailVerificationBackdrop'),
                smsVerification: document.getElementById('smsVerificationBackdrop')
            };
        }
        
        open(modalName, callback) {
            // Close current modal first if exists
            if (this.currentModal) {
                this.close(this.currentModal, () => {
                    this._openModal(modalName, callback);
                });
            } else {
                this._openModal(modalName, callback);
            }
            
            // Save to localStorage for persistence
            localStorage.setItem('pendingVerification', modalName);
        }
        
        _openModal(modalName, callback) {
            const modal = this.modals[modalName];
            if (!modal) {
                console.error(`Modal ${modalName} not found`);
                return;
            }
            
            this.currentModal = modalName;
            
            // Use setTimeout to ensure smooth transition
            setTimeout(() => {
                modal.classList.add('active');
                if (callback) callback();
            }, 50);
        }
        
        close(modalName, callback) {
            const modal = this.modals[modalName];
            if (!modal) return;
            
            modal.classList.add('closing');
            modal.classList.remove('active');
            
            setTimeout(() => {
                modal.classList.remove('closing');
                if (this.currentModal === modalName) {
                    this.currentModal = null;
                }
                if (callback) callback();
            }, 300); // Match CSS transition duration
        }
        
        closeAll() {
            Object.keys(this.modals).forEach(modalName => {
                const modal = this.modals[modalName];
                modal.classList.remove('active', 'closing');
            });
            this.currentModal = null;
        }
        
        clearVerificationState() {
            localStorage.removeItem('pendingVerification');
            localStorage.removeItem('verificationEmail');
            localStorage.removeItem('verificationPhone');
        }
        
        restoreVerificationState() {
            const pendingModal = localStorage.getItem('pendingVerification');
            const email = localStorage.getItem('verificationEmail');
            const phone = localStorage.getItem('verificationPhone');
            
            if (pendingModal && (email || phone)) {
                // Show floating button
                const floatingBtn = document.getElementById('floatingVerifyBtn');
                if (floatingBtn) {
                    floatingBtn.style.display = 'block';
                }
                
                // Restore modal
                this.open(pendingModal);
                
                return true;
            }
            return false;
        }
    }
    
    // Initialize Modal Manager
    const modalManager = new ModalManager();
    
    // Restore verification state on page load
    setTimeout(() => {
        modalManager.restoreVerificationState();
    }, 500);
    
    // Close button handlers
    const closeEmailModal = document.getElementById('closeEmailModal');
    const closeSmsModal = document.getElementById('closeSmsModal');
    const floatingVerifyBtn = document.getElementById('floatingVerifyBtn');
    
    if (closeEmailModal) {
        closeEmailModal.addEventListener('click', function() {
            modalManager.close('emailVerification');
            floatingVerifyBtn.style.display = 'block';
        });
    }
    
    if (closeSmsModal) {
        closeSmsModal.addEventListener('click', function() {
            modalManager.close('smsVerification');
            floatingVerifyBtn.style.display = 'block';
        });
    }
    
    // Floating verify button handler
    if (floatingVerifyBtn) {
        floatingVerifyBtn.addEventListener('click', function() {
            const pendingModal = localStorage.getItem('pendingVerification');
            if (pendingModal) {
                modalManager.open(pendingModal);
                floatingVerifyBtn.style.display = 'none';
            }
        });
    }
    
    // Multi-step form logic
    let currentStep = 1;
    const totalSteps = 4;
    const form = document.getElementById('chefRegistrationForm');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const progressFill = document.getElementById('progressFill');
    
    // Get all step elements
    const formSteps = document.querySelectorAll('.form-step');
    const stepIndicators = document.querySelectorAll('.step');
    
    // Password toggle
    const passwordInput = document.getElementById('password');
    const togglePassword = document.getElementById('togglePassword');
    const eyeIcon = document.getElementById('eyeIcon');
    
    togglePassword.addEventListener('click', function() {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        
        if (type === 'text') {
            eyeIcon.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>';
        } else {
            eyeIcon.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/>';
        }
    });
    
    // Email validation
    const emailInput = document.getElementById('email');
    const emailError = document.getElementById('emailError');
    
    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }
    
    emailInput.addEventListener('blur', function() {
        if (this.value && !validateEmail(this.value)) {
            emailError.classList.add('show');
            this.classList.add('input-error');
        } else {
            emailError.classList.remove('show');
            this.classList.remove('input-error');
        }
    });
    
    // Password strength checker
    const passwordStrength = document.getElementById('passwordStrength');
    const strengthFill = document.getElementById('strengthFill');
    const lengthReq = document.getElementById('lengthReq');
    const uppercaseReq = document.getElementById('uppercaseReq');
    const lowercaseReq = document.getElementById('lowercaseReq');
    const numberReq = document.getElementById('numberReq');
    const specialReq = document.getElementById('specialReq');
    
    function checkPasswordStrength(password) {
        const requirements = {
            length: password.length >= 8,
            uppercase: /[A-Z]/.test(password),
            lowercase: /[a-z]/.test(password),
            number: /[0-9]/.test(password),
            special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
        };
        
        lengthReq.classList.toggle('met', requirements.length);
        uppercaseReq.classList.toggle('met', requirements.uppercase);
        lowercaseReq.classList.toggle('met', requirements.lowercase);
        numberReq.classList.toggle('met', requirements.number);
        specialReq.classList.toggle('met', requirements.special);
        
        const metCount = Object.values(requirements).filter(Boolean).length;
        strengthFill.className = 'strength-fill';
        
        if (metCount <= 2) {
            strengthFill.classList.add('weak');
        } else if (metCount <= 4) {
            strengthFill.classList.add('medium');
        } else {
            strengthFill.classList.add('strong');
        }
        
        return metCount === 5;
    }
    
    passwordInput.addEventListener('input', function() {
        if (this.value) {
            passwordStrength.classList.add('show');
            checkPasswordStrength(this.value);
        } else {
            passwordStrength.classList.remove('show');
        }
    });
    
    // File upload handling
    const photoInput = document.getElementById('photo');
    const fileUploadArea = document.getElementById('fileUploadArea');
    const filePreview = document.getElementById('filePreview');
    const previewImage = document.getElementById('previewImage');
    const previewName = document.getElementById('previewName');
    
    fileUploadArea.addEventListener('click', function() {
        photoInput.click();
    });
    
    photoInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImage.src = e.target.result;
                previewName.textContent = file.name;
                filePreview.classList.add('show');
                fileUploadArea.classList.add('has-file');
            };
            reader.readAsDataURL(file);
        }
    });
    
    // Step navigation
    function showStep(step) {
        formSteps.forEach((formStep, index) => {
            if (index + 1 === step) {
                formStep.classList.add('active');
            } else {
                formStep.classList.remove('active');
            }
        });
        
        stepIndicators.forEach((indicator, index) => {
            if (index + 1 < step) {
                indicator.classList.add('completed');
                indicator.classList.remove('active');
            } else if (index + 1 === step) {
                indicator.classList.add('active');
                indicator.classList.remove('completed');
            } else {
                indicator.classList.remove('active', 'completed');
            }
        });
        
        // Update progress bar
        const progress = (step / totalSteps) * 100;
        progressFill.style.width = progress + '%';
        
        // Update buttons
        if (step === 1) {
            prevBtn.style.display = 'none';
        } else {
            prevBtn.style.display = 'flex';
        }
        
        if (step === totalSteps) {
            nextBtn.querySelector('.btn-text').textContent = 'Complete Registration';
        } else {
            nextBtn.querySelector('.btn-text').textContent = 'Next Step';
        }
    }
    
    function validateStep(step) {
        const currentFormStep = document.querySelector(`.form-step[data-step="${step}"]`);
        const inputs = currentFormStep.querySelectorAll('input[required], textarea[required]');
        let isValid = true;
        
        inputs.forEach(input => {
            if (!input.value.trim()) {
                input.classList.add('input-error');
                isValid = false;
            } else {
                input.classList.remove('input-error');
            }
            
            // Special validation for email
            if (input.type === 'email' && input.value && !validateEmail(input.value)) {
                input.classList.add('input-error');
                emailError.classList.add('show');
                isValid = false;
            }
            
            // Special validation for password
            if (input.type === 'password' && input.value && !checkPasswordStrength(input.value)) {
                isValid = false;
            }
        });
        
        // Special validation for file upload in step 2
        if (step === 2 && !photoInput.files.length) {
            fileUploadArea.style.borderColor = '#ef4444';
            isValid = false;
        }
        
        return isValid;
    }
    
    nextBtn.addEventListener('click', function() {
        if (currentStep < totalSteps) {
            if (validateStep(currentStep)) {
                currentStep++;
                showStep(currentStep);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                showNotification('Please fill in all required fields', 'error');
            }
        } else {
            // Submit form
            if (validateStep(currentStep)) {
                submitForm();
            } else {
                showNotification('Please fill in all required fields', 'error');
            }
        }
    });
    
    prevBtn.addEventListener('click', function() {
        if (currentStep > 1) {
            currentStep--;
            showStep(currentStep);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    });
    
    // Allow clicking on step indicators
    stepIndicators.forEach((indicator, index) => {
        indicator.addEventListener('click', function() {
            const targetStep = index + 1;
            if (targetStep < currentStep || (targetStep === currentStep + 1 && validateStep(currentStep))) {
                currentStep = targetStep;
                showStep(currentStep);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });
    });
    
    // Notification function
    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        
        notificationText.textContent = message;
        notification.className = 'notification';
        if (type === 'error') {
            notification.classList.add('error');
        }
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }
    
    // Form submission
    function submitForm() {
        nextBtn.classList.add('loading');
        nextBtn.disabled = true;
        
        const formData = new FormData(form);
        
        fetch('/chef/register', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            nextBtn.classList.remove('loading');
            nextBtn.disabled = false;
            
            if (data.success) {
                // Store email and phone for verification
                const userEmail = emailInput.value.trim();
                const userPhone = document.getElementById('phone').value.trim();
                
                showNotification('Registration successful! Sending verification code...', 'success');
                
                // Automatically send email verification code
                sendEmailVerificationCode(userEmail);
            } else {
                showNotification(data.message || 'Registration failed', 'error');
            }
        })
        .catch(error => {
            console.error('Registration Error:', error);
            nextBtn.classList.remove('loading');
            nextBtn.disabled = false;
            showNotification('Error during registration: ' + error.message, 'error');
        });
    }
    
    // Function to send email verification code
    function sendEmailVerificationCode(email) {
        // Save email to localStorage for persistence
        localStorage.setItem('verificationEmail', email);
        
        fetch('/send_email_code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email: email })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Show email verification modal using modal manager
                modalManager.open('emailVerification', () => {
                    startEmailResendTimer();
                    showNotification('Verification code sent to your email!', 'success');
                });
            } else {
                showNotification(data.message || 'Failed to send verification code', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Error sending verification code', 'error');
        });
    }
    
    // Function to send SMS verification code
    function sendSmsVerificationCode(phone) {
        // Save phone to localStorage for persistence
        localStorage.setItem('verificationPhone', phone);
        
        fetch('/send_sms_code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ phone: phone })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Show SMS verification modal using modal manager
                modalManager.open('smsVerification', () => {
                    startSmsResendTimer();
                    showNotification('Verification code sent to your phone!', 'success');
                });
            } else {
                showNotification(data.message || 'Failed to send SMS code', 'error');
                // If SMS fails, redirect to pending page
                setTimeout(() => {
                    window.location.href = '/chef/pending';
                }, 2000);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Error sending SMS code', 'error');
            // If SMS fails, redirect to pending page
            setTimeout(() => {
                window.location.href = '/chef/pending';
            }, 2000);
        });
    }
    
    // Verification modal handlers
    const chooseEmailBtn = document.getElementById('chooseEmailBtn');
    const chooseSmsBtn = document.getElementById('chooseSmsBtn');
    const verificationChoiceBackdrop = document.getElementById('verificationChoiceBackdrop');
    const emailVerificationBackdrop = document.getElementById('emailVerificationBackdrop');
    const smsVerificationBackdrop = document.getElementById('smsVerificationBackdrop');
    
    chooseEmailBtn.addEventListener('click', function() {
        const email = emailInput.value;
        
        fetch('/send_email_code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email: email })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Close choice modal and open email verification modal
                modalManager.close('verificationChoice', () => {
                    modalManager.open('emailVerification', () => {
                        startEmailResendTimer();
                    });
                });
            } else {
                showNotification(data.message || 'Failed to send verification code', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Error sending verification code', 'error');
        });
    });
    
    chooseSmsBtn.addEventListener('click', function() {
        const phone = document.getElementById('phone').value;
        
        fetch('/send_sms_code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ phone: phone })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Close choice modal and open SMS verification modal
                modalManager.close('verificationChoice', () => {
                    modalManager.open('smsVerification', () => {
                        startSmsResendTimer();
                    });
                });
            } else {
                showNotification(data.message || 'Failed to send verification code', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Error sending verification code', 'error');
        });
    });
    
    // Email verification
    const verifyEmailBtn = document.getElementById('verifyEmailBtn');
    const emailCodeInput = document.getElementById('emailCode');
    const emailCodeError = document.getElementById('emailCodeError');
    
    verifyEmailBtn.addEventListener('click', function() {
        const code = emailCodeInput.value;
        const email = emailInput.value;
        
        if (!code || code.length !== 4) {
            emailCodeError.textContent = 'Please enter a valid 4-digit code';
            emailCodeError.style.display = 'block';
            return;
        }
        
        verifyEmailBtn.disabled = true;
        verifyEmailBtn.innerHTML = '<span class="btn-text">Verifying...</span>';
        
        fetch('/verify_email_code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email: email, code: code })
        })
        .then(response => response.json())
        .then(data => {
            verifyEmailBtn.disabled = false;
            verifyEmailBtn.innerHTML = '<span class="btn-text">Verify Email</span>';
            
            if (data.success) {
                emailCodeError.style.display = 'none';
                showNotification('Email verified successfully! Sending SMS code...', 'success');
                
                // Close email modal and open SMS modal
                modalManager.close('emailVerification', () => {
                    // Automatically send SMS verification code
                    const phone = document.getElementById('phone').value;
                    sendSmsVerificationCode(phone);
                });
            } else {
                emailCodeError.textContent = data.message || 'Invalid verification code';
                emailCodeError.style.display = 'block';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            verifyEmailBtn.disabled = false;
            verifyEmailBtn.innerHTML = '<span class="btn-text">Verify Email</span>';
            emailCodeError.textContent = 'Error verifying code';
            emailCodeError.style.display = 'block';
        });
    });
    
    // Add Enter key support for email code input
    emailCodeInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            verifyEmailBtn.click();
        }
    });
    
    // SMS verification
    const verifySmsBtn = document.getElementById('verifySmsBtn');
    const smsCodeInput = document.getElementById('smsCode');
    const smsCodeError = document.getElementById('smsCodeError');
    
    // Add Enter key support for SMS code input
    smsCodeInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            verifySmsBtn.click();
        }
    });
    
    verifySmsBtn.addEventListener('click', function() {
        const code = smsCodeInput.value;
        const phone = document.getElementById('phone').value;
        
        if (!code || code.length !== 4) {
            smsCodeError.textContent = 'Please enter a valid 4-digit code';
            smsCodeError.style.display = 'block';
            return;
        }
        
        verifySmsBtn.disabled = true;
        verifySmsBtn.innerHTML = '<span class="btn-text">Verifying...</span>';
        
        fetch('/verify_sms_code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ phone: phone, code: code })
        })
        .then(response => response.json())
        .then(data => {
            verifySmsBtn.disabled = false;
            verifySmsBtn.innerHTML = '<span class="btn-text">Verify SMS</span>';
            
            if (data.success) {
                smsCodeError.style.display = 'none';
                showNotification('Phone verified successfully! Redirecting to pending...', 'success');
                
                // Clear verification state from localStorage
                modalManager.clearVerificationState();
                
                // Close SMS modal and redirect
                modalManager.close('smsVerification', () => {
                    setTimeout(() => {
                        window.location.href = data.redirect || '/chef/pending';
                    }, 1000);
                });
            } else {
                smsCodeError.textContent = data.message || 'Invalid verification code';
                smsCodeError.style.display = 'block';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            verifySmsBtn.disabled = false;
            verifySmsBtn.innerHTML = '<span class="btn-text">Verify SMS</span>';
            smsCodeError.textContent = 'Error verifying code';
            smsCodeError.style.display = 'block';
        });
    });
    
    // Resend timers
    const resendEmailCodeBtn = document.getElementById('resendEmailCodeBtn');
    const emailResendTimer = document.getElementById('emailResendTimer');
    let emailResendCountdown = 0;
    
    function startEmailResendTimer() {
        emailResendCountdown = 60;
        resendEmailCodeBtn.disabled = true;
        resendEmailCodeBtn.style.opacity = '0.5';
        
        const interval = setInterval(() => {
            emailResendCountdown--;
            emailResendTimer.textContent = `Resend available in ${emailResendCountdown}s`;
            
            if (emailResendCountdown <= 0) {
                clearInterval(interval);
                resendEmailCodeBtn.disabled = false;
                resendEmailCodeBtn.style.opacity = '1';
                emailResendTimer.textContent = '';
            }
        }, 1000);
    }
    
    resendEmailCodeBtn.addEventListener('click', function() {
        const email = emailInput.value;
        
        fetch('/send_email_code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email: email })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('New verification code sent!', 'success');
                startEmailResendTimer();
            } else {
                showNotification(data.message || 'Failed to resend code', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Error resending code', 'error');
        });
    });
    
    const resendSmsCodeBtn = document.getElementById('resendSmsCodeBtn');
    const smsResendTimer = document.getElementById('smsResendTimer');
    let smsResendCountdown = 0;
    
    function startSmsResendTimer() {
        smsResendCountdown = 60;
        resendSmsCodeBtn.disabled = true;
        resendSmsCodeBtn.style.opacity = '0.5';
        
        const interval = setInterval(() => {
            smsResendCountdown--;
            smsResendTimer.textContent = `Resend available in ${smsResendCountdown}s`;
            
            if (smsResendCountdown <= 0) {
                clearInterval(interval);
                resendSmsCodeBtn.disabled = false;
                resendSmsCodeBtn.style.opacity = '1';
                smsResendTimer.textContent = '';
            }
        }, 1000);
    }
    
    resendSmsCodeBtn.addEventListener('click', function() {
        const phone = document.getElementById('phone').value;
        
        fetch('/send_sms_code', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ phone: phone })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('New verification code sent!', 'success');
                startSmsResendTimer();
            } else {
                showNotification(data.message || 'Failed to resend code', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Error resending code', 'error');
        });
    });
    
    // Initialize
    showStep(1);
});
</script>
{% endblock %}
